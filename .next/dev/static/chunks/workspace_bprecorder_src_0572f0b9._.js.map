{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/user/workspace/bprecorder/src/components/BPChart.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  Chart as ChartJS,\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend,\n  TimeScale\n} from 'chart.js';\nimport { Line } from 'react-chartjs-2';\n\nChartJS.register(\n  CategoryScale,\n  LinearScale,\n  PointElement,\n  LineElement,\n  Title,\n  Tooltip,\n  Legend\n);\n\ninterface Record {\n  id: number;\n  systolic: number;\n  diastolic: number;\n  pulse: number;\n  recorded_at: string;\n}\n\ninterface BPChartProps {\n  records: Record[];\n}\n\nexport default function BPChart({ records }: BPChartProps) {\n  const data = {\n    labels: records.map(r => new Date(r.recorded_at).toLocaleDateString()),\n    datasets: [\n      {\n        label: '收缩压 (高压)',\n        data: records.map(r => r.systolic),\n        borderColor: 'rgb(255, 99, 132)',\n        backgroundColor: 'rgba(255, 99, 132, 0.5)',\n        tension: 0.3\n      },\n      {\n        label: '舒张压 (低压)',\n        data: records.map(r => r.diastolic),\n        borderColor: 'rgb(53, 162, 235)',\n        backgroundColor: 'rgba(53, 162, 235, 0.5)',\n        tension: 0.3\n      },\n    ],\n  };\n\n  const options = {\n    responsive: true,\n    plugins: {\n      legend: {\n        position: 'top' as const,\n      },\n      title: {\n        display: true,\n        text: '近期血压趋势',\n      },\n    },\n    scales: {\n        y: {\n            min: 40,\n            max: 200,\n        }\n    }\n  };\n\n  return <Line options={options} data={data} />;\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AAWA;AAbA;;;;AAeA,mMAAO,CAAC,QAAQ,CACd,2MAAa,EACb,yMAAW,EACX,0MAAY,EACZ,yMAAW,EACX,mMAAK,EACL,qMAAO,EACP,oMAAM;AAeO,SAAS,QAAQ,EAAE,OAAO,EAAgB;IACvD,MAAM,OAAO;QACX,QAAQ,QAAQ,GAAG,CAAC,CAAA,IAAK,IAAI,KAAK,EAAE,WAAW,EAAE,kBAAkB;QACnE,UAAU;YACR;gBACE,OAAO;gBACP,MAAM,QAAQ,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;gBACjC,aAAa;gBACb,iBAAiB;gBACjB,SAAS;YACX;YACA;gBACE,OAAO;gBACP,MAAM,QAAQ,GAAG,CAAC,CAAA,IAAK,EAAE,SAAS;gBAClC,aAAa;gBACb,iBAAiB;gBACjB,SAAS;YACX;SACD;IACH;IAEA,MAAM,UAAU;QACd,YAAY;QACZ,SAAS;YACP,QAAQ;gBACN,UAAU;YACZ;YACA,OAAO;gBACL,SAAS;gBACT,MAAM;YACR;QACF;QACA,QAAQ;YACJ,GAAG;gBACC,KAAK;gBACL,KAAK;YACT;QACJ;IACF;IAEA,qBAAO,wNAAC,4LAAI;QAAC,SAAS;QAAS,MAAM;;;;;;AACvC;KAzCwB"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/user/workspace/bprecorder/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport BPChart from \"@/components/BPChart\";\nimport { UploadCloud, Save, Loader2, RefreshCw, AlertCircle } from \"lucide-react\";\nimport clsx from \"clsx\";\n\ninterface Record {\n  id: number;\n  systolic: number;\n  diastolic: number;\n  pulse: number;\n  recorded_at: string;\n}\n\nexport default function Home() {\n  const [records, setRecords] = useState<Record[]>([]);\n  const [analyzing, setAnalyzing] = useState(false);\n  const [analyzedData, setAnalyzedData] = useState<{\n    systolic: number;\n    diastolic: number;\n    pulse: number;\n  } | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const fetchRecords = useCallback(async () => {\n    try {\n      const res = await fetch(\"/api/records\");\n      const data = await res.json();\n      if (Array.isArray(data)) {\n        setRecords(data);\n      }\n    } catch (e) {\n      console.error(\"Failed to fetch records\", e);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchRecords();\n  }, [fetchRecords]);\n\n  const onDrop = useCallback(async (acceptedFiles: File[]) => {\n    const file = acceptedFiles[0];\n    if (!file) return;\n\n    setAnalyzing(true);\n    setError(null);\n    setAnalyzedData(null);\n\n    const formData = new FormData();\n    formData.append(\"file\", file);\n\n    try {\n      const res = await fetch(\"/api/analyze\", {\n        method: \"POST\",\n        body: formData,\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setAnalyzedData(data);\n      }\n    } catch (e) {\n      setError(\"识别失败，请重试\");\n    } finally {\n      setAnalyzing(false);\n    }\n  }, []);\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    accept: { \"image/*\": [] },\n    maxFiles: 1,\n  });\n\n  const handleSave = async () => {\n    if (!analyzedData) return;\n\n    try {\n      const res = await fetch(\"/api/records\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n            ...analyzedData,\n            recorded_at: new Date().toISOString()\n        }),\n      });\n\n      if (res.ok) {\n        setAnalyzedData(null);\n        fetchRecords();\n      } else {\n        alert(\"保存失败\");\n      }\n    } catch (e) {\n      alert(\"保存出错\");\n    }\n  };\n\n  return (\n    <main className=\"min-h-screen bg-gray-50 p-4 md:p-8\">\n      <div className=\"max-w-4xl mx-auto space-y-8\">\n        <header className=\"flex items-center justify-between pb-6 border-b\">\n          <h1 className=\"text-3xl font-bold text-gray-800\">血压每日记录</h1>\n          <button \n            onClick={fetchRecords} \n            className=\"p-2 text-gray-500 hover:text-gray-700 transition-colors\"\n            title=\"刷新数据\"\n          >\n            <RefreshCw size={20} />\n          </button>\n        </header>\n\n        {/* Upload Section */}\n        <div\n          {...getRootProps()}\n          className={clsx(\n            \"border-2 border-dashed rounded-xl p-8 text-center transition-all cursor-pointer bg-white shadow-sm\",\n            isDragActive ? \"border-blue-500 bg-blue-50\" : \"border-gray-300 hover:border-gray-400\",\n            analyzing && \"opacity-50 pointer-events-none\"\n          )}\n        >\n          <input {...getInputProps()} />\n          <div className=\"flex flex-col items-center justify-center gap-4\">\n            {analyzing ? (\n              <>\n                <Loader2 className=\"animate-spin text-blue-600\" size={48} />\n                <p className=\"text-lg font-medium text-gray-600\">AI 正在识别血压读数...</p>\n              </>\n            ) : (\n              <>\n                <UploadCloud className=\"text-blue-500\" size={48} />\n                <div>\n                  <p className=\"text-lg font-medium text-gray-700\">\n                    {isDragActive ? \"释放文件以上传\" : \"点击或拖拽血压计照片到这里\"}\n                  </p>\n                  <p className=\"text-sm text-gray-500 mt-2\">支持 JPG, PNG 格式</p>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2\">\n            <AlertCircle size={20} />\n            <span>{error}</span>\n          </div>\n        )}\n\n        {/* Confirmation Form */}\n        {analyzedData && (\n          <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-200 animate-in fade-in slide-in-from-bottom-4\">\n            <h2 className=\"text-xl font-semibold mb-4 flex items-center gap-2\">\n              <span className=\"w-2 h-6 bg-green-500 rounded-full\"></span>\n              确认数据\n            </h2>\n            <div className=\"grid grid-cols-3 gap-4 mb-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-600 mb-1\">收缩压 (高压)</label>\n                <input\n                  type=\"number\"\n                  value={analyzedData.systolic}\n                  onChange={(e) => setAnalyzedData({ ...analyzedData, systolic: Number(e.target.value) })}\n                  className=\"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-lg font-bold text-gray-800\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-600 mb-1\">舒张压 (低压)</label>\n                <input\n                  type=\"number\"\n                  value={analyzedData.diastolic}\n                  onChange={(e) => setAnalyzedData({ ...analyzedData, diastolic: Number(e.target.value) })}\n                  className=\"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-lg font-bold text-gray-800\"\n                />\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium text-gray-600 mb-1\">脉搏</label>\n                <input\n                  type=\"number\"\n                  value={analyzedData.pulse}\n                  onChange={(e) => setAnalyzedData({ ...analyzedData, pulse: Number(e.target.value) })}\n                  className=\"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-lg font-bold text-gray-800\"\n                />\n              </div>\n            </div>\n            <div className=\"flex justify-end gap-3\">\n              <button\n                onClick={() => setAnalyzedData(null)}\n                className=\"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\"\n              >\n                取消\n              </button>\n              <button\n                onClick={handleSave}\n                className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2 font-medium transition-all\"\n              >\n                <Save size={18} />\n                确认并保存\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Charts & Stats */}\n        <div className=\"grid grid-cols-1 gap-6\">\n          <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-200\">\n             {records.length > 0 ? (\n                <BPChart records={records} />\n             ) : (\n                <div className=\"text-center py-12 text-gray-400\">暂无记录，请上传第一张照片</div>\n             )}\n          </div>\n          \n          {/* Recent List */}\n          {records.length > 0 && (\n              <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-200\">\n                  <h3 className=\"text-lg font-semibold mb-4\">最近记录</h3>\n                  <div className=\"overflow-x-auto\">\n                      <table className=\"w-full text-left\">\n                          <thead className=\"text-gray-500 border-b\">\n                              <tr>\n                                  <th className=\"pb-3 font-medium\">时间</th>\n                                  <th className=\"pb-3 font-medium\">收缩压</th>\n                                  <th className=\"pb-3 font-medium\">舒张压</th>\n                                  <th className=\"pb-3 font-medium\">脉搏</th>\n                              </tr>\n                          </thead>\n                          <tbody className=\"text-gray-700\">\n                              {records.slice(0, 5).map((r) => (\n                                  <tr key={r.id} className=\"border-b last:border-0\">\n                                      <td className=\"py-3\">{new Date(r.recorded_at).toLocaleString()}</td>\n                                      <td className=\"py-3 font-medium\">{r.systolic}</td>\n                                      <td className=\"py-3 font-medium\">{r.diastolic}</td>\n                                      <td className=\"py-3\">{r.pulse}</td>\n                                  </tr>\n                              ))}\n                          </tbody>\n                      </table>\n                  </div>\n              </div>\n          )}\n        </div>\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}